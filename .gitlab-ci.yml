image: mtr.external.otc.telekomcloud.com/mcsps/mcsps-tools:latest
#
#
before_script:
- apk add openssh-client
- mkdir -p ~/.ssh/
- echo "Host *" > ~/.ssh/config
- echo "UserKnownHostsFile /dev/null" >> ~/.ssh/config
- echo "StrictHostKeyChecking no" >> ~/.ssh/config
- echo "IdentitiesOnly yes" >> ~/.ssh/config

- eval $(ssh-agent -s)
- test -n "$GITHUB_SSH_PRIVATE_KEY" && ssh-add <(echo "$GITHUB_SSH_PRIVATE_KEY")
- export GIT_SSH_COMMAND="ssh -o ForwardAgent=yes"
 
stages:
- deliver-github

deliver-github:
  stage: deliver-github
  tags:
    - k8s-executor
  script:
  - ssh-agent -l
  - git config --global user.name "MCSPS Dol Sync"
  - git config --global user.email "mcsps-dis@telekom.de"
  - git remote remove github || true
  - git remote add github ssh://git@github.com/mcsps/use-cases
  - git remote -v
  - git fetch github
  - git push github --force HEAD:master

# vim: sts=2 sw=2 ts=2 et:
